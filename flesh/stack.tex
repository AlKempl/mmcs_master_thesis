\chapter{Технологический стек}
\label{chap:stack}
Под стеком технологий в данном контексте можно понимать набор из следующих объектов, использование которых позволяет реализовать поставленную задачу:
\begin{enumerate}
	\item Язык программирования и среда разработки.
	\item Набор библиотек и расширений для обогащения функционала.
\end{enumerate}

\section{Язык программирования и среда разработки}
Для разработки под Android традиционно предпочитают язык программирования Java, хотя в последнее время все более популярным и продвигаемым~\autocite{kotlin} для этих целей считается Kotlin, как более гибкий и удобный. В данной работе было принято решение использовать последний.
Несмотря на его относительную новизну, под него уже существует достаточно обширный набор библиотек и компонентов для работы с ОС Android и железными компонентами устройств, а также сервисов Google.


Для комфортной разработки приложений Google создала на базе умной IDE от JetBrains свою собственную – Android Studio~\autocite{android_studio}. Она позволяет разрабатывать приложения под ОС Android с возможностью интерактивного изменения визуальных представлений активностей, поддерживает анализ синтаксиса на обоих актуальных языках программирования (Java/Kotlin), автоматически управляет зависимостями для системы сборки проектов Gradle~\autocite{gradle_kolin} и подсказывает типовые ошибки в коде и доступности интерфейса.


\section{Библиотеки и средства расширения функционала}
Концептуальный алгоритм минимально рабочего прототипа выглядит следующим образом:
\smallskip
\begin{itemize}
	\item Получить данные о геолокации устройства.
	\item Положить их во внутреннюю базу данных.
\end{itemize}
\smallskip

Разработка приложения под Android предполагает определенные ограничения и возможности: Google с каждой новой версией ОС Android вводит все более серьезные изменения в механизмы работы с компонентами устройства и ОС, например, отдельный механизм запроса геолокации устройства в фоновом режиме теперь требует отображения специального уведомления в шторке.
Так, для взаимодействия с этими компонентами требуется использовать соответствующие пакеты из API Reference~\autocite{android_api}.


\subsection*{Получение и обработка геоданных}
\label{subsec:geodata}
Получать данные о геолокации устройства в Android можно несколькими способами:
\begin{enumerate}
	\item Используя методы обращения к сервисам устройства, получить доступ к сервису геолокации, проверить методы геолокации (GPS, Сеть) и на их основе совершить «запрос геолокации», получив результат.
	\item Использовать методы FusedLocationProvider~\autocite{android_fused_location_provider} из пакета Google [Play] Services, которые самостоятельно определят подходящий сервис получения геоданных и вернут результат.
\end{enumerate}
\smallskip
В рамках данной работы был выбран второй вариант. Для этого был подключен пакет play-services-location из пакета com.google.android.gms.
Для получения дополнительных данных о физической активности пользователя устройства был подключен пакет play-services-fitness из того же пакета, что и сервис геолокации выше.
Все эти пакеты поставляются Google и, хотя их можно использовать в коде сразу после синхронизации проекта, для физического использования их функциональности может потребоваться запрос у пользователя некоторых разрешений, например, для работы приложения в фоне или получения данных о его физической активности.


\subsection*{Методы организации хранения данных}
В качестве базы данных была выбрана система SQLite~\autocite{sqlite}, представляющая из себя базу данных в одном файле, хранящемся на устройстве пользователя.
Для упрощения работы с базой был использован пакет Android Room~\autocite{android_room}. Он предоставляет возможность применения некоторых уровней абстракции для работы с данными из базы, такие как Сущность (Entity), DAO (Data Access Object, объект доступа к данным), а также такие концепты как LiveData (объект доступа к данным в реальном времени) и ViewModel (объект, связывающий данные с компонентом представления пользовательского интерфейса).


\subsection*{Преобразование текста в речь}
Для более глубокого погружения пользователя в игру и повышения концентрации игрока на безопасности движения без постоянного наблюдения за экраном приложения в телефоне используется система TTS (англ. Text-to-Speech \textemdash\space Текст в речь). Она также представляет из себя библиотеку пакета PlayServices и не требует постоянного соединения с Интернетом. 
При необходимости воспроизвести текст в речь используется один из встроенных методов, который указывает игроку на происходящие внутриигровые события, при этом не заставляет его постоянно смотреть на экран устройства.


Также для повышения качества озвучивания внутриигровых событий при настройке TTS была использована опция ``голосовые инструкции'', которая имеет высокий приоритет при микшировании звука устройства и при наличии дополнительных источников звука, например, стороннего музыкального приложения, они будут приглушены для обеспечения чёткости голосовых инструкций.
