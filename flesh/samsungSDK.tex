\chapter{Программная реализация сбора биометрии}
В качестве дополнительного метода защиты здоровья пользователя было принято решение анализировать его пульс во время тренировок.
Получение пульса возможно путём взаимодействия с устройствами сбора пользовательской биометрии, такими как умные часы и браслеты.

\section{Выбор метода сбора биометрии}
Для определения доступных возможностей был проведён сравнительный анализ нескольких методов получение биометрических данных:
\begin{itemize}
	\item Выполнение запросов к датчикам биометрии напрямую на носимом устройстве.
	\item Выполнение запроса к сервисам биометрии Google.
	\item Выполнение запроса к агрегатору биометрии на устройстве от Google.
	\item Выполнение запроса к агрегатору биометрии вендора носимых устройств.
\end{itemize}
\smallskip
Результат сравнительного анализа представлен в таблице \ref{tab:biometrics_comparison}.

\newcolumntype{s}{>{\hsize=.4\hsize}X}
\newcolumntype{t}{>{\hsize=.25\hsize}X}

%table
\begin{table}[H]
	\centering
	\caption{\label{tab:biometrics_comparison}Результаты сравнительного анализа методов получения биометрии}
	\small
	\begin{threeparttable}
		\begin{tabularx}{\textwidth}{sXt}
			\toprule
			Метод сбора \newline биометрии
			& Описание и ограничения
			& Вывод \\
			\midrule\midrule
			Прямой запрос к датчикам носимого устройства
			& Предоставляет полные\tnote{1} данные в реальном времени\tnote{2}. \newline Для доступа к датчикам носимого устройства требуется сборка приложения-компаньона для загрузки на носимое устройство
			& Не\newline подходит \\\midrule
			Запрос к сервисам биометрии Google
			& Предоставляет полные исторические\tnote{3} данные. \newline Для доступа к биометрии требуется платный аккаунт, с которого отправляются запросы к API Google, подразумевается постоянное наличие соединения с Интернетом.
			& Не\newline подходит \\\midrule
			Запрос к агрегатору биометрии на устройстве от Google
			& Предоставляет полные\tnote{1} исторические\tnote{3} данные. \newline Реализуется через запущенный в тестирование в 2022 г. проект Google Health SDK. Требуется установка приложения-компаньона на устройство, настройка синхронизации и предоставление разрешений пользователем. Представляется неинтуитивным и требует много дополнительных действий со стороны конечного пользователя.
			& Не\newline подходит \\\midrule
			Запрос к агрегатору биометрии вендора носимых устройств
			& Предоставляет полные\tnote{1} исторические\tnote{3} данные. \newline Для доступа к данным требуется подключение к приложению пакета SDK соответствующего вендора.
			& Подходит \\
			\bottomrule
		\end{tabularx}
		\smallskip
		\footnotesize
		\begin{tablenotes}
			\item[1] Без ограничений на объем получаемых данных и с обширным списком доступных биометрических показателей.
			\item[2] Предоставляется возможность отслеживать изменения значений показателя в реальном времени и реагировать на них.
			\item[3] Предоставляется возможность выгрузить историю значений показателя за некоторый временной интервал в прошлом.
		\end{tablenotes}
	\end{threeparttable}
\end{table}
\smallskip

Исходя из результатов сравнительного анализа методов получения биометрических данных, было принято решение использовать запросы к агрегатору данных конкретного вендора носимых устройств.
С учетом особенностей получения вендорских данных концепция второй системы защиты здоровья игрока через отслеживание пульса была изменена в пользу отслеживания истории изменения пульса на протяжении тренировки в момент её завершения.

\section{Определение вендора биометрических данных}
Сейчас на рынке присутствует большое количество различных производителей умных носимых устройств:
\begin{multicols}{2}
\begin{itemize}
	\item Xiaomi;
	\item Huawei;
	\item Garmin;
	\item Samsung;
	\item Apple;
	\item Honor.
\end{itemize}
\end{multicols}

и многие другие.


В рамках данной работы требовалось собрать минимальный рабочий прототип приложения для геймификации бега, поэтому интеграция со всеми вендорами представляется избыточной и, в некотором роде невозможной. 

С учётом приведённого выше аргумента и наличия в прямой доступности экземпляра умных часов Samsung было принято решение интегрироваться с Samsung Health SDK. 

В следующем разделе опишем некоторые подробности интеграции с выбранным вендором.

\section{Особенности реализации сбора биометрии через Samsung Health SDK}
Для интеграции с Samsung Health SDK требуется произвести ряд шагов:
\begin{enumerate}
	\item Принять условия пользовательского соглашения на сайте Samsung.
	\item Скачать в каталог проекта приложения на Android собранную библиотеку SDK в формате JAR.
	\item Подключить ее в систему сборки gradle.
\end{enumerate}
\smallskip
После этого можно приступать к получению и обработке биометрических данных от Samsung.

\subsection{Получение данных}
Samsung Health SDK позволяет получать широкий набор биометрических данных:
\begin{multicols}{2}
	\begin{itemize}
		\item Пройденные шаги;
		\item Пройденные этажи;
		\item Длительность сна;
		\item Фазы сна;
		\item Статистика питания;
		\item Объем выпитой воды;
		\item Объем принятого кофеина;
		\item Артериальное давление;
		\item Частота сердечных сокращений;
		\item Антропометрические показатели:
		\begin{itemize}
			\item Рост;
			\item Вес;
			\item Температура тела.
		\end{itemize}
		\item Мышечная масса;
		\item Некоторые биохимические показатели крови.
	\end{itemize}
\end{multicols}
\smallskip
Часть показателей собирается системами вендора в автоматическом режиме (например, шаги, пульс, длительность сна), тогда как другие \textemdash\space вносятся пользователем самостоятельно в вендорское приложение-компаньон.

В рамках данной работы требуется получить пульс пользователя. Этот показатель рассчитывается автоматически на основе данных с умных часов Samsung, подключённых к телефону пользователя.

Здесь стоит ещё раз отметить особенность работы с Sasmsung Health SDK: данный подход не позволяет получать информацию в реальном времени. Дальнейшее исследование показало, что на от часов к устройству данные передаются с большой задержкой и получение псевдо-онлайн данных также не возможно.

\subsection{Nhfnfnf}
dfdfdf