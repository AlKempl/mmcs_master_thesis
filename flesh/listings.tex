\begin{comment}
	TODO!!!!!
	\chapter{Листинги}

\subsection{Алгоритм синхронизации занятий при изменении даты начала семестра}
\begin{ListingEnv}
	\begin{lstlisting}[language=SQL]
		
		create or replace function first_study_date_set(pdate character varying) returns integer
		language plpgsql
		as
		$$
		declare
		vCurrentFisrtStudyDate varchar := '';
		vWeeksBetween          int      := 0;
		begin
		
		-- if no date set
		vCurrentFisrtStudyDate := pdate;
		
		select vals
		from settings
		where key = 'first_study_date'
		into vCurrentFisrtStudyDate;
		
		select round((vCurrentFisrtStudyDate::date - pdate::date) / 7)
		into vWeeksBetween;
		
		update lessons
		set lesson_dt = lesson_dt - (vWeeksBetween || 'weeks')::interval
		where lesson_dt >= pdate::date;
		
		return setting_set('first_study_date', 0, pdate);
		end;
		$$;
		
		alter function first_study_date_set(varchar) owner to schedule;
		
	\end{lstlisting}
	\caption{DDL для метода first\_study\_date\_set}
	\label{list:first_study_date_set}
\end{ListingEnv}
\end{comment}